\documentclass[a4paper]{article}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{tabularx}

\title{Forensics analysis of USB device traces\\
\large Digital Forensics}

\author{
\begin{tabular}{>{\raggedleft}m{5cm}m{5cm}}
I. Duits & (1876171) \\
E. Geretto & (1869426) \\
G. Iadarola & (1879480) \\
\end{tabular}
}

\begin{document}
\maketitle

\abstract{The use of computers has increased exponentially in the last decade,
so has cybercrime and the need for digital forensics. The use of Linux computers
is growing, but there are almost no digital forensics tools that can scan a
Linux image and support for Ext4 file system is poor on Windows. In this paper
we will give an overview on Linux logging deamons and we will introduce a tool,
USB Log Parser, which is able to retrieve information about USB devices from
them and can help in covering the gap on Linux forensics tools compatibility.
The tool covers most of the commonly used Linux distributions, like Ubuntu and
Fedora, handling differences in logging systems.}

\section{Introduction}
Nowadays, our entire life is managed through electronic devices and the number of
connected users is going to grow in the future. Nevertheless, several
problems have to be faced and need to be managed in order to keep benefiting
from the computing devices revolution.

Everyone can get access and interact with PCs and smartphones and also criminals
are using them to perpetrate frauds and illegal activities. Indeed, the Digital
Forensics branch is becoming one of the most important sectors in the forensics
and investigation field. By inspecting and analysing computer systems, officers
can retrieve essential evidence to prove and demonstrate criminal events.

Log files are one of the most important sources of information when trying to
reconstruct the events that lead to a certain situation in a computer system.
They are constructed recording a series of timestamped messages, generated by
the various components of the system, that, when considered as a whole, give a
complete overview of the operations in execution at a given moment.

Given the information they contain, log files are also one of the most important
sources of information during a forensics investigation since they allow to
trace possibly malicious activity through time. As a consequence, it is
essential to be able to retrieve and analyse them in the fastest way
possible.~\cite{finlayson1987log}

One of the main problems when analysing log files is that they tend to be huge
in terms of the number of messages collected in them. For this reason, forensics
investigators usually rely on tools that automatize the process of extraction
and parsing in order to extract immediately the relevant information.

There are already so many operating systems on the market, which use different
storing format and log files structures and so they required different tools in
order to analyze efficiently the system.

The percentage of Windows desktop and laptop user is around 90\%~\cite{usagePC}
of the market share, and the digital forensic tools available this line because
most of them run on Windows environment only. For instance, $FTK~Imager$ which
is a useful tool used by many investigators, does not support Ext4, which is a
standard format for Linux systems. By looking at the statistics, the Linux user
holds around the 2\% percent of the market share, but more than 66\% of internet
servers run a Linux distribution and taking into account only the Web developers
the 22\% of the programmers work on Linux~\cite{usagePC}. Most of the digital
forensic tools are proprietary and hardly compatible with Linux distributions.
Furthermore, also the open source projects are not always compatible with Linux
system, for instance Autopsy is completly open source but the Linux version can
perform only a small subset of operations compared to the Windows one.

Unfortunatly, Windows does not have native support for Linux filesystems. The
Open Source community has risen to the challenge and created some excellent
software to solve this problem (for instance, Ext2Read~\cite{ext2read}), but
investigation is also matter of time, and be able to recover automatically the
information needed from a system in a short time, without looking manually for
them, can make the difference.

Moreover, because the entire Linux world is open source and mantained by free
work of people, it is not easily accessible by performing just accademic
researchs. Linux developers prefer writing guides or articles on blogs rather
than scientific papers. So, there is also a lack of knowledge on functionalities
about Linux system from a scientific and accademic point of view.

This paper aims to contribute in filling these gaps by presenting an overview on
Linux logging deamons and by introducing a tool, USB Log Parser, which is able
to retrieve information about USB devices. The tool was developed by the authors
as a forensic soundness tool which can help digital forensic investigators in
extracting useful information from USB devices and the traces they leave on
operating systems quickly.

USB devices can be used to transfer valuable data in cases of data theft or
possession of illegal material; knowledge about when a USB device was connected
can be really helpful in the investigation. As implied by the Locard's exchange
principle~\cite{locard2008locard}, every contact leaves a trace. These traces are
recoverable as reported for instance by several researches available in the
literature.~\cite{Tanushree12,Abhijeet14}

In Section~\ref{sec:lit}, this paper discusses how to access this information in
both Windows and Linux systems. In the Windows environment, there are many tools
which can help analysing and retrieving data but, on Linux, there are just a
few. In order to contribute to the Digital Forensics field on Linux systems, we
developed an open source tool that will help investigators in retrieving data
about USB devices from an image of Linux installation. The approach taken and
the general structure of the program are described in Section~\ref{sec:contrib}.
The tool was tested on an image of Linux installation and the result are
presented in Section~\ref{sec:result}. The last section contains instead a short
summary of our conclusions.

\section{Log files and USB devices}
\label{sec:lit}

Given that different operating systems generate log files structured in a
different way and store them at different locations, the following subsections
will provide an overview of where the files are located and which tools can
be used to analyse them in Linux and Windows. Moreover, particular attention
will be given to the information relative to USB devices, since it is the main
focus of this study.

\subsection{Windows}\label{sec:litWindows}
In the newest iterations of Microsoft Windows, all the log files are stored by
default in the folder
\texttt{\%SystemRoot\%\textbackslash{}system32\textbackslash{}winevt\textbackslash{}Logs}.
These files can be opened with a tool called \emph{Event Viewer} in order to
examine their content. This tool, however, allows only for simple automatic
analysis, as a general keyword search, but it does not automatically extract
the most relevant information stored.

From a forensics investigator perspective, the use of Event Viewer implies a
tedious and error prone manual analysis that is surely not desirable. For this
reason, other tools have been developed that allow the extraction and analysis
of log files from system images in an automatic fashion, so that the
investigator just needs to observe the relevant data and connect them to the
evidence already collected.

These tools are time saving and, most importantly, the analysis of the evidence
can be considered forensically sound. Indeed, in order to avoid damaging or
contaminating the evidence collected, the system analysed should always be
imaged and the image should be hashed in order to allow for a subsequent
verification of the investigative process. These tools allow for the analysis of
these images directly and guarantee the absence of contamination during the
process.~\cite{murphey2007automated}

The open source tool that is most commonly used for this purpose is called
\emph{Autopsy}, developed by \emph{SleuthKit}; between other things, it also
analyses the system logs and extracts a list of all the USB devices that were
attached to the machine according to the information in the files. This allows
an investigator to retrieve important information, as the serial number of the
device or the time of insertion and deletion. This information is important, for
example, to track USB sticks across different machines.~\cite{deb2015usb}

\subsection{Linux}
Regarding the Linux operating system, the kernel has an internal log which every
module can write on, including the USB drivers. This log, called internal ring
buffer, is not directly stored in persistent memory; indeed, this task is
demanded to other services that also collect logs from other sources, as the
\emph{X11} display server, and construct a general system log.

Unfortunately, different distributions use different log-handling daemons and
even different versions of the same daemon may store the log files in
different locations. The most common ones are the \emph{syslog} daemon, which
stores the log in the \texttt{/var/log/syslog} file in plaintext, and the
\emph{journald} daemon, part of the systemd project, which stores the files in
the \texttt{/var/log/journal/} directory in binary format. There are also other
interesting combinations that include collecting the data using journald and
then store them in a syslog compatible format, as Ubuntu and derivatives
do.~\cite{poettering2012journal}

All the USB related information flows from the kernel ring buffer to the log
daemon and gets stored in one of these locations. Given the variety of locations
and daemons that are currently being used, to the best of our knowledge, there
is no automated tool that is capable of extracting automatically, from a disk
image, information about USB devices; currently, the only option is manual
analysis.

\section{USB device tracking on Linux}
\label{sec:contrib}
Given the absence of a forensics tool that is capable of analysing images taken
on Linux systems in order to retrieve USB device information, it was decided to
implement one in Python leveraging several libraries already available.

Since the data that needs to be retrieved can be found in two forms, namely
syslog text files or journald binary log files, it was decided to implement a
tool capable of distinguishing between the two and parse both file formats.

In Subsection~\ref{sec:prems} all the dependencies and compatibility
considerations will be listed, explaining the reasons behind the choice of the
supported distributions. Subsection~\ref{sec:images} will instead be used to
describe the procedure followed for the creation of the images used in the
study. Finally, Subsection~\ref{sec:tool} will describe the general structure of
the tool and the reflections made while constructing it.

\subsection{Dependencies and compatibility}
\label{sec:prems}
In the development of our tool, we used two main libraries that need
to be installed on the machine performing the analysis:
\texttt{imagemounter} and \texttt{python-systemd}. Both the libraries were used
in their Python 3 version.

Regarding \texttt{imagemounter}, it is simply a wrapper for
SleuthKit~\cite{sleuthkit}, a set of tools on which Autopsy, mentioned before,
is also based.  This library offers APIs that make mounting an EnCase image from
inside a Python script quite easy, allowing then the program to explore the
directories required for the analysis.

The \texttt{python-systemd} library is instead a Python wrapper for the C APIs
that allow the interaction with the journald log daemon. The use of this library
was necessary in order to parse the binary format in which the logs are stored
and extract the relevant information. The positive thing about the use of this
module is that it grants access to all the information related to the production
of the log format, for example the kernel subsystem that actually created a
certain message.

Regarding instead the supported distributions, the choice of supporting Ubuntu
was quite obvious. This distribution, indeed, apart from having a large market
share by itself, is also the base for many others, as Linux Mint, all the Ubuntu
spins and Elementary OS to name a few. Taking all these distributions into
consideration, a good percentage of the Linux desktop users is covered.

Regarding the choice related to how the system logs are stored, the Ubuntu
developers made the choice of exploiting systemd's new functionalities, but to
avoid storing the logs in binary format. Indeed, Ubuntu uses journald to collect
the logs but then dumps them in a syslog compatible log, as already described
before and in the literature.~\cite{patil2016digital} For this reason, the
support of Ubuntu required the writing of a parser for that particular format.

Given that syslog, or at least syslog compatible logs were covered, Fedora was
chosen as the second distribution to be supported. This choice was done because
it is one of the main distributions that, as opposed to Ubuntu, use the
journald binary format.

A third distribution that was evaluated for the analysis was OpenSUSE
considering, again, its market share and the similarity to its commercial
counterpart, SUSE Linux Enterprise. Unfortunately, after completing the imaging
process, we realized that the filesystem used for the root partition in
OpenSUSE, the new BtrFS, introduced some years ago, is still not supported by
\texttt{imagemounter}, since it is not commonly used. For this reason, we had to
exclude it from the analysis.

As far as the compatibility of the tool is concerned, it is restricted to the
same compatibility of the libraries \texttt{python-systemd} and
\texttt{imagemounter}. As a good point, since the tool is based on these two
libraries, it will increase the compatibility when these libraries will increase
the support for different systems.

Regarding the versions of the distributions used, we employed Fedora 25 and
Ubuntu 17.04, the latest versions available at the moment of writing.

\subsection{Creation of the images}
\label{sec:images}
The machine used to collect the images was a HP ProBook 6570b with UEFI
support, on which every distribution was installed in sequence. For every
image, a similar iteration was followed:
\begin{itemize}
\item Installation with default settings.
\item Update to the packets available on the 29th of May 2017.
\item Installation of all the missing drivers, in particular the WiFi one.
\item Insertion and extraction of one USB stick 2.0, one USB stick 3.0 and a USB
	mouse.
\item Reboot in a live environment.
\item Creation of a raw image of the root partition.
\item Conversion of the image in EnCase format using FTK Imager.
\end{itemize}
It is relevant to point out that the hash of the images was checked across the
whole process in order to prevent any kind of corruption.

\subsection{The tool}\label{sec:tool}
Once the images are obtained, it is possible to feed them to the tool in order
to receive as output a table containing various information related to all the
USB devices that were connected to the systems, according to the system logs.

Under the hood, the tool exploits the capabilities of the \texttt{imagemounter}
library to try to mount every volume contained in the EnCase image provided and
checks if it is a root Linux filesystem containing the standard log directory.
If this is the case, the tool determines then which one between syslog and
journald was used to collect the logs and then starts the parsing process using
the appropriate submodule.

It is important to note that, if several Linux installations are present on the
same system, as in a dual boot context, the tool will correctly detect both
installations and present the results related to both systems. All other
partitions will simply be ignored.

After the individuation of the log files, according to the type of log, the
file is feed to a different submodule. The one processing syslog files takes
care of filtering, one by one, the lines from the full system log and extracts
only those that have been generated by the USB subsystem, while the second
leverages the \texttt{python-systemd} library in order to parse the binary file
and achieve the same result through filters on the fields in the binary
entries.

Once all the messages generated by the USB subsystem are obtained, the tool
starts looking for fixed string patterns in order to extract information from
lines about USB devices. Indeed, the patterns were created to localize lines
which store information about time of connection (both in and out) and
regarding product name, manufacturer and serial number.

The tool analyses all the messages generated by the USB subsystem. When a
pattern matches one, the line is parsed and the information retrieved. The new
data is then saved inside an object which stores all the information found for
the same USB device. Finally, all the information is printed grouped by USB
device.

Because the tool is based on the libraries \texttt{imagemounter} and
\texttt{python-systemd}, the forensic soundness of its operations is implied by
the operations of these libraries. The other tools that use these libraries are
well-known forensic tools and they are considered reliable by the forensics
expert commynity. For instance, \texttt{imagemounter} is a wrapper for
SleuthKit, used by Autopsy as well~\cite{sleuthkit}. Moreover, the tool does not
work on the original data but just on copies of them, since it handles images of
Linux distribution in EnCase format, which preserve integrity. Finally, all the
code is open source and everyone can verify the correctness of every operation.

\section{Result}
\label{sec:result}

USAGE AND SCREENSHOTS

\section{Conclusion}
\label{sec:concl}
It is a matter of fact that Windows does not have native support for Linux
filesystems. Once more, compatibility problems were faced also during the
development of the tool. Since the most used forensic tools run on Windows,
analysing Linux systems is harder than Windows ones.

Nevertheless, for the sake of completeness, the investigators cannot assume
that the criminals will use Windows only. Because of that, it is really
important to develop software to handle all the possible distributions and file
systems in order to produce precise and complete investigations. On this
assumptions, our tool can contribute in analyzing USB devices traces on Linux
systems.

The developed tool is able to retrieve logs quickly. By extracting and parsing
only a restricted set of files, it reports the USB traces immediately.
Obviously, it cannot produce a complete analysis of the images but will not
waste time in deep analysis when it is not required. Indeed, when USB devices
are involved during an investigation, just demonstrating the connection to a
victim machine can be enough to prove the criminal act.

Moreover, the analysis produced by the tool is forensically sound, because it
does not compromise the integrity of the images since it works on system
images.

In conclusion, this paper reported a short overview on log files across
different operating systems, while the developed tool aims to contribute in the
forensic field by simplifying the analysis of USB devices logs on Linux
systems.

\bibliographystyle{plain}
\bibliography{sample}

\end{document}

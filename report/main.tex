\documentclass[a4paper]{article}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{tabularx}

\title{Forensics analysis of USB device traces\\
\large Digital Forensics}

\author{
\begin{tabular}{>{\raggedleft}m{5cm}m{5cm}}
I. Duits & (1876171) \\
E. Geretto & (1869426) \\
G. Iadarola & (1879480) \\
\end{tabular}
}

\begin{document}
\maketitle

\section{Introduction}
Nowadays, almost a half of all the households in Western Europe have a personal
computer and the percentage increases over 90\% by taking into account only
young people (15 to 30 years old).

The number of computing devices as PCs, laptops and smartphones has increased
exponentially in the past decade. Daily activities are organized on social
media, works are performed on laptops and meetings on video-conferences. Our
entire life is managed through electronic devices and the number of connected
users is going to grow in the future. The government's (most of them) and the
public's opinions do agree with these changes and support every initiative
which increases the use of new technologies. Nevertheless, several problems have
to be faced and need to be managed in order to keep benefiting from the
computing devices revolution.

Everyone can get access and interact with PCs and smartphones and also criminals
are using them to perpetrate frauds and illegal activities. Indeed, the Digital
Forensics branch is becoming one of the most important sectors in the forensics
and investigation field. By inspecting and analysing computer systems, officers
can retrieve essential evidence to prove and demonstrate criminal events.

This paper aims to contribute in this field and is focused on USB devices and
the traces they leave on operating systems.

USB devices can be used to transfer valuable data in cases of data theft or
possession of illegal material; knowledge about when a USB device was connected
can be really helpful in the investigation. As stated in the Locard's exchange
principle~\cite{locard2008locard}, copying data leaves traces. These traces are
recoverable as reported for instance by several researches available in the
literature.~\cite{Tanushree12,Abhijeet14}.

In Section~\ref{sec:lit}, this paper discusses how to access this information
in both Windows and Linux systems. In the Windows environment, there are many
tools which can help analysing and retrieving data but, on Linux, there are
just few. Windows is the most used operating system, but Linux usage is
increasing and actually most of the servers run a Linux
distribution.~\cite{osShare,InternetServer} In order to contribute to the
Digital Forensics field on Linux systems, we developed an open source tool that
will help investigators in retrieving data about USB devices from an image of
Linux installation. The approach taken and the general structure of the program
are described in Section~\ref{sec:contrib}. The last section contains instead a
short summary of our conclusions.

\section{Log files and USB devices}
\label{sec:lit}
Log files are one of the most important sources of information when trying to
reconstruct the events that lead to a certain situation in a computer system.
Indeed, they are constructed recording a series of timestamped messages,
generated by the various components of the system, that, when considered as a
whole, give a complete overview of the operations in execution at a given
moment.

Given the information they contain, log files are also one of the most important
sources of information during a forensics investigation since they allow to
trace possibly malicious activity through time. As a consequence, it is
essential to be able to retrieve and analyse them in the fastest way
possible.~\cite{finlayson1987log}

One of the main problems when analysing log files is that they tend to be huge
in terms of the number of messages collected in them. For this reason, forensics
investigators usually rely on tools that automatize the process of extraction
and parsing in order to extract immediately the relevant information.

Given that different operating systems generate log files structured in a
different way and store them at different locations, the following subsections
will provide an overview of where the files are located and which tools can
be used to analyse them in Linux and Windows. Moreover, particular attention
will be given to the information relative to USB devices, since it is the main
focus of this study.

\subsection{Windows}\label{sec:litWindows}
In the newest iterations of Microsoft Windows, all the log files are stored by
default in the folder
\texttt{\%SystemRoot\%\textbackslash{}system32\textbackslash{}winevt\textbackslash{}Logs}.
These files can be opened with a tool called \emph{Event Viewer} in order to
examine their content. This tool, however, allows only for simple automatic
analysis, as a general keyword search, but it does not automatically extract
the most relevant information stored.

From a forensics investigator perspective, the use of Event Viewer implies a
tedious and error prone manual analysis that is surely not desirable. For this
reason, other tools have been developed that allow the extraction and analysis
of log files from system images in an automatic fashion, so that the
investigator just needs to observe the relevant data and connect them to the
evidence already collected.

These tools are time saving and, most importantly, the analysis of the evidence
can be considered forensically sound. Indeed, in order to avoid damaging or
contaminating the evidence collected, the system analysis should always be
imaged and the image should be hashed in order to allow for a subsequent
verification of the investigative process. These tools allow for the analysis of
these images directly and guarantee the absence of contamination during the
process.~\cite{murphey2007automated}

The open source tool that is most commonly used for this purpose is called
\emph{Autopsy}, developed by \emph{SleuthKit}; between other things, it also
analyses the system logs and extracts a list of all the USB devices that were
attached to the machine according to the information in the files. This allows
an investigator retrieve important information, as the serial number of the
device or the time of insertion and deletion. This information is important, for
example, to track USB sticks across different machines.~\cite{deb2015usb}

\subsection{Linux}
Regarding the Linux operating system, the kernel has an internal log which every
module can write on, including the USB drivers. This log, called internal ring
buffer, is not directly stored in persistent memory; indeed, this task is
demanded to other services that also collect logs from other sources, as the
\emph{X11} display server, and construct a general system log.

Unfortunately, different distributions use different log-handling daemons and
even different versions of the same daemon may store the log files in
different locations. The most common ones are the \emph{syslog} daemon, which
stores the log in the \texttt{/var/log/syslog} file in plaintext, and the
\emph{journald} daemon, part of the systemd project, which stores the files in
the \texttt{/var/log/journal/} directory in binary format. There are also other
interesting combinations that include collecting the data using journald and
then store them in a syslog compatible format, as Ubuntu and derivatives
do.~\cite{poettering2012journal}

All the USB related information flows from the kernel ring buffer to the log
daemon and gets stored in one of these locations. Given the variety of locations
and daemons that are currently being used, to the best of our knowledge, there
is no automated tool that is capable of extracting automatically, from a disk
image, information about USB devices; currently, the only option is manual
analysis.

\section{USB device tracking on Linux}
\label{sec:contrib}
Given the absence of a forensics tool that is capable of analysing images taken
on Linux systems in order to retrieve USB device information, it was decided to
implement one in Python leveraging several libraries already available.

Since the data that needs to be retrieved can be found in two forms, namely
syslog text files or journald binary log files, it was decided to implement a
tool capable of distinguishing between the two and parse both file formats.

In Subsection~\ref{sec:prems} all the dependencies and compatibility
considerations will be listed, explaining the reasons behind the choice of the
supported distributions. Subsection~\ref{sec:images} will instead be used to
describe the procedure followed for the creation of the images used in the
study. Finally, Subsection~\ref{sec:tool} will describe the general structure of
the tool and the reflections made while constructing it.

\subsection{Dependencies and compatibility}
\label{sec:prems}
In the development of our tool, we leveraged two main Python libraries that need
to be installed on the host machine while performing the analysis:
\texttt{imagemounter} and \texttt{python-systemd}. Both the libraries were used
in their Python 3 version.

Regarding \texttt{imagemounter}, this library is simply a wrapper for
SleuthKit, a set of tools on which Autopsy, mentioned before, is also based.
This library offers APIs that make mounting an EnCase image from inside a Python
script quite easy, allowing then the program to explore the directories required
for the analysis.

The \texttt{python-systemd} library is instead a Python wrapper for the C APIs
that allow the interaction with the journald log daemon. The use of this library
was necessary in order to parse the binary format in which the logs are stored
and extract the relevant information. The positive thing about the use of this
module is that it grants access to all the information related to the production
of the log format, for example the kernel subsystem that actually created a
certain message.

Regarding instead the supported distributions, the choice of supporting Ubuntu
was quite obvious. This distribution, indeed, apart from having a large market
share by itself, is also the base for many others, as Linux Mint, all the Ubuntu
spins and Elementary OS to name a few. Taking all these distributions into
consideration, a good percentage of the Linux desktop user is covered.

Regarding the choice related to how the system logs are stored, the Ubuntu
developers made the choice of exploiting systemd's new functionalities, but to
avoid storing the logs in binary format. Indeed, Ubuntu uses journald to
collect the logs but then dumps them in a syslog compatible log, as already
described before. For this reason, the support of Ubuntu required the writing of
a parser for that particular format.

Given that syslog, or at least syslog compatible logs, Fedora was chosen as the
second distribution to be supported. This choice was done because it is one of
the main distributions that, as opposed to Ubuntu, use the journald binary
format.

A third distribution that was considered for the analysis was OpenSUSE
considering, again, its market share and the similarity to it's commercial
counterpart, SUSE Linux Enterprise. Unfortunately, after completing the imaging
process, we realized that the filesystem used for the root partition in
OpenSUSE, the new BtrFS, introduced some years ago, is still not supported by
\texttt{imagemounter}, since it is not commonly used. For this reason, we had to
exclude it from the analysis.

Regarding the versions of the distributions used, we employed Fedora 25 and
Ubuntu 17.04, the latest versions available at the moment of writing.

\subsection{Creation of the images}
\label{sec:images}
The machine used to collect the images was a HP XXX with UEFI support, on which
every distribution was installed in sequence. For every image, a similar
iteration was followed:
\begin{itemize}
\item Installation with default settings.
\item Update to the packets available on the 29th of May 2017.
\item Installation of all the missing drivers, in particular the WiFi one.
\item Insertion and extraction of one USB stick 2.0, one USB stick 3.0 and a USB
	mouse.
\item Reboot in a live environment.
\item Create a raw image of the root partition.
\item Conversion of the image in EnCase format using FTK Imager.
\end{itemize}
It is relevant to point out that the hash of the images was checked across the
whole process in order to prevent any kind of corruption.

\subsection{The tool}\label{sec:tool}
Once the images are obtained, it is possible to feed them to the tool in order
to receive as output a table containing several information related to all the
USB devices that were connected to the systems, according to the system logs.

Under the hood, the tool exploits the capabilities of the \texttt{imagemounter}
library to try to mount every volume contained in the EnCase image provided and
checks if it is a root Linux filesystem containing the standard log directory.
If this is the case, the tool determines then which one between syslog and
journald was used to collect the logs and then starts the parsing process using
the appropriate submodule.

It is important to note that, if several Linux installations are present on the
same system, as in a dual boot context, the tool will correctly detect both
installations and present the results related to both systems. All other
partitions will simply be ignored.

After the individuation of the log files, according to the type of log, the file
is feed to a different submodule. The one processing syslog files takes care of
filtering, one by one, the lines from the full system log and extract only those
that have been generated by the USB subsystem, while the second leverages the
\texttt{python-systemd} library in order to parse the binary file and achieve
the same result through filters on the fields in the binary entries.

Once all the messages generated by the USB subsystem are obtained, ...
% This final part should be about how the Parser class works and which
% information is extracted from which message

\section{Conclusion}
\label{sec:concl}
Once more, support for Ext4 file system is really poor on windows environment.
By developing this tool, compatibility problems were faced on Windows system.
Since the most used forensic tools run on this system, it is really important to
develop software to handle all the possible distributions and file systems in
order to produce precise and complete investigations. On this assumptions, our
tool can contribute in analyzing USB devices traces on Linux systems.

The developed tool is able to retrieve logs quickly. By extracting and parsing
only a restricted set of files, it reports the USB traces immediatly. Obviously,
it cannot produce a complete analysis of the images but will not waste time in
deep analysis when it is not required. Indeed, when USB devices are involved
during an investigation, just demostrating the connection to a victim machine
can be enough to prove the criminal act.

Moreover, the analysis produce by the tool is forensically sound, because it
does not compromise the integrity of the images since it works on copies.

In conclusion, this paper reported a short overview on log files across
different operating systems, while the developed tool aim to contribute in the
forensic field by simplifying the analysis of USB devices log on Linux systems.

\bibliographystyle{plain}
\bibliography{sample}

\end{document}
